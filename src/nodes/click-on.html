<script type="text/html" data-template-name="click-on">
	<div class="form-row">
		<label for="node-input-name"><i class="fa fa-globe"></i> <span>Name</span></label>
		<input type="text" id="node-input-name">
	</div>
	<div class="form-row">
		<label for="node-input-selector"><i class="fa fa-empire"></i> <span>By</span></label>
		<select id="node-input-selector" style="width:125px !important">
			<option value=""></option>
			<option value="id">id</option>
			<option value="name">name</option>
			<option value="link">link</option>
			<option value="xpath">xpath</option>
			<option value="tagName">tagName</option>
			<option value="className">className</option>
			<option value="linkText">linkText</option>
			<option value="cssSelector">cssSelector</option>
		</select>
	</div>
	<div class="form-row">
		<label for="node-input-target"><i class="fa fa-empire"></i> <span>Target</span></label>
		<input type="text" id="node-input-target">
	</div>
	<div class="form-row">
		<label for="node-input-timeout"><i class="fa fa-empire"></i> <span>Timeout</span></label>
		<input type="text" id="node-input-timeout" value="1000">
	</div>
	<div class="form-row">
		<label for="node-input-waitFor"><i class="fa fa-empire"></i> <span>Wait For</span></label>
		<input type="text" id="node-input-waitFor" value="00">
	</div>
	<div class="form-row">		
		<input type="checkbox" id="node-input-clickOn" style="display: inline-block; width: auto; vertical-align: top;">
		<label for="node-input-clickOn" style="width: 70%"> <span>Require manual approval on click to continue</span></label>
	</div>
</script>

<script type="text/html" data-help-name="click-on">
	<p>Click on the <code>msg.element</code> which is passed by previous node or after waiting for the expected element is located.</p>
	<strong>Inputs:</strong>
	<p><ul>
		<li><a>By</a>: specify the way to find an element by selector. The <code>msg.selector</code> will override the <code>By</code> field if set.</li>
		<li><a>Target</a>: specify the selector's value to lookup. The<code>msg.target</code> will override the <code>Target</code> field if set.</li>
		<li><a>Timeout</a>: specify the timeout during lookup operation. The <code>msg.timeout</code> will override the <code>Timeout</code> field if set.</li>
		<li><a>Wait For</a>: specify the time to wait before looking up. The <code>msg.waitfor</code> will override the <code>Wait For</code> field if set.</li>
		<li><a>Click On</a>: specify to wait until user click action on the node. The <code>msg.clickOn</code> will override the <code>Click On</code> field if set.</li>
	</ul></p>	
	<strong>Outputs:</strong>
	<p><code>msg.error</code> When the object is unexpected or cannot find element, this node generates the error with detail information</p>
	<p><code>msg.element</code> If the element is found, it will be passed though the msg object to the next node.</p>
</script>

<script type="text/javascript">
	RED.nodes.registerType('click-on', {
		category : 'wd2',
		defaults : {
			name : {
				value : ""
			},
			selector : {
				value : ""
			},
			target : {
				value : ""
			},
			timeout : {
				value : 1000,
				validate : RED.validators.number()
			}, 
			waitFor : {
				value : 500,
				validate : RED.validators.number()
			},
			clickOn : {
				value : false
			}
		},
		color : "#47B6EE",
		inputs : 1,
		outputs : 2,
		icon : "font-awesome/fa-mouse-pointer",
		label : function() {
			return this.name || "Click On";
		},
		labelStyle : function() {
			return this.name ? "node_label_italic" : "";
		},
		button: {			
            onclick: function() {
                var node = this;
                $.ajax({
                    url: "onclick/" + this.id,
                    type:"POST",
                    success: function(resp) {
                        RED.notify(node._("inject.success",{ label:label }),"success");
                    },
                    error: function(jqXHR,textStatus,errorThrown) {
                        if (jqXHR.status == 404) {
                            RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.not-deployed")}),"error");
                        } else if (jqXHR.status == 500) {
                            RED.notify(node._("common.notification.error",{message:node._("inject.errors.failed")}),"error");
                        } else if (jqXHR.status == 0) {
                            RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.no-response")}),"error");
                        } else {
                            RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.unexpected",{status:jqXHR.status,message:textStatus})}),"error");
                        }
                    }
                });
            }
        }
	}); 
</script>